# Supabase Table Schemas for Trust Engine

## TelemetryData Table

Recommended columns:

| Column           | Type        | Description                        |
|------------------|-------------|------------------------------------|
| id               | bigint      | Primary key (auto-increment)       |
| vm_id            | text        | VM identifier                      |
| timestamp        | timestamptz | Event timestamp                    |
| event_type       | text        | Type of event                      |
| stride_category  | text        | STRIDE threat category             |
| risk_level       | int4        | Risk level (1-5)                   |
| features         | jsonb       | All 62 features as JSON            |

**Example SQL:**
```sql
create table if not exists "TelemetryData" (
  id bigint generated by default as identity primary key,
  vm_id text not null,
  timestamp timestamptz not null,
  event_type text,
  stride_category text,
  risk_level int4,
  features jsonb
);
```

---

## TrustScore Table

Recommended columns:

| Column        | Type        | Description                        |
|---------------|-------------|------------------------------------|
| id            | bigint      | Primary key (auto-increment)       |
| session_id    | text        | Session identifier                 |
| vm_id         | text        | VM identifier                      |
| timestamp     | timestamptz | Time of trust score calculation    |
| trust_score   | float8      | Calculated trust score             |
| mfa_required  | bool        | Whether MFA is required            |

**Example SQL:**
```sql
create table if not exists "TrustScore" (
  id bigint generated by default as identity primary key,
  session_id text not null,
  vm_id text not null,
  timestamp timestamptz not null,
  trust_score float8 not null,
  mfa_required bool not null
);
```

---

## Best Practices: SQL Syntax

### 1. Add Indexes for Performance
```sql
-- TelemetryData indexes
create index if not exists telemetrydata_session_id_idx on "TelemetryData" (vm_id);
create index if not exists telemetrydata_timestamp_idx on "TelemetryData" (timestamp);

-- TrustScore indexes
create index if not exists trustscore_session_id_idx on "TrustScore" (session_id);
create index if not exists trustscore_vm_id_idx on "TrustScore" (vm_id);
create index if not exists trustscore_timestamp_idx on "TrustScore" (timestamp);
```

### 2. Enable Row Level Security (RLS)
```sql
alter table "TelemetryData" enable row level security;
alter table "TrustScore" enable row level security;
```

### 3. Example: Grant Select to Authenticated Users
```sql
grant select on table "TelemetryData" to authenticated;
grant select on table "TrustScore" to authenticated;
```

### 4. API Key Management
- Store your Supabase credentials in environment variables or a `.env` file:
  ```env
  SUPABASE_URL=your-supabase-url
  SUPABASE_API_KEY=your-supabase-api-key
  ```
- Never commit your API keys to version control. 